<!doctype html>
<style>
    textarea { vertical-align: bottom; }
    #output { overflow: auto; }
    #output > p { overflow-wrap: break-word; }
    #output span { color: blue; }
    #output span.error { color: red; }
</style>
<h2>WebSocket Test</h2>
<textarea cols=60 rows=6></textarea>
<div>Status: 
    <span id=connection-status>DISCONNECTED</span>
</div>
<button id=send-editor>Send Editor Data</button>
<button id=send-large-data>Send Large Data</button>
<button id=close-connection>Close Connection</button>
<div id=output></div>
<script>
    // http://www.websocket.org/echo.html

    var btnSendEditor = document.querySelector("#send-editor"),
        btnSendLargeData = document.querySelector("#send-large-data"),
        btnSendClose = document.querySelector("#close-connection"),
        output = document.querySelector("#output"),
        textarea = document.querySelector("textarea"),
        connectionStatus = document.querySelector("#connection-status"),
        wsUri = "ws://127.0.0.1/",
        websocket = new WebSocket(wsUri);

    btnSendEditor.addEventListener("click", onClickButton);
    btnSendLargeData.addEventListener("click", btnSendLargeData_onClick);
    btnSendClose.addEventListener("click", btnSendClose_onClick);


    websocket.onopen = function (e) {
        connectionStatus.innerHTML = "CONNECTED"
        doSend("connection test");
        // websocket.send("*".repeat(129));
        // websocket.send("*".repeat(65535));
    };

    websocket.onclose = function (e) {
        connectionStatus.innerHTML = "DISCONNECTED"
        writeToScreen("<span>RESPONSE: " + e + "</span>");
        window.e = e;

        // writeToScreen("DISCONNECTED");
    };

    websocket.onmessage = function (e) {
        writeToScreen("<span>RESPONSE: " + e.data + "</span>");
    };

    websocket.onerror = function (e) {
        writeToScreen("<span class=error>ERROR:</span> " + e);
    };

    function doSend(message) {
        writeToScreen("SENDING: " + message);
        websocket.send(message);
    }

    function writeToScreen(message) {
        output.insertAdjacentHTML("afterbegin", "<p>" + message + "</p>");
    }

    function onClickButton() {
        sendEditorContent();
    }

    function btnSendLargeData_onClick() {
        websocket.send("_".repeat(65533) + "UUUUU");  // 65538
    }

    function btnSendClose_onClick() {
        websocket.close();
    }

    function sendEditorContent() {
        var text = textarea.value;

        text && doSend(text);
        textarea.value = "";
        textarea.focus();
    }
</script>